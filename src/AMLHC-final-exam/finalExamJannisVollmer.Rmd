---
title: "AMLHC - Final Exam - Jannis Vollmer"
author: Jannis Vollmer
output: html_notebook
---
```{r}
  require(caret)
```

# Introduction
The following Notebook analyses the data set "Cirrhosis Patient Survival Prediction" by the Mayo Clinic from the years 1974 to 1984. The question to answer with this data set is, if it is possible to predict the survival state of patients with liver cirrhoses. Cirrhosis is a disease, caused by liver damage and leads to extensive scarring. The main origin is often Hepatitis or heavy and constant alcohol consumption.

# Description of the data set
The data source is a study by the Mayo Clinic on primary biliary liver cirrhosis (PBC) from the years 1974 to 1984. The data set consists of one target variable (Status), 16 Feature and 1 other variables. Each instance in the data set represents a person. There are two features that might be considered as sensitive (Age and Gender). In the following sub-chapter the different variables are described with the possible values.

## Variable description
The following table explains what content is behind each variable in the data set. The target variable is the "Status". The other ones, except the "ID" and "N_Days" are Feature variables.

| Variable Name | Description                                                                                          | Role   |
|---------------|------------------------------------------------------------------------------------------------------|--------|
| ID            | unique identifier                                                                                    | Other  |
| N_Days        | number of days between registration and the earlier of death, transplantation, or study analysis time in July 1986 | Other  |
| Status        | status of the patient C (censored), CL (censored due to liver tx), or D (death)                      | Target |
| Drug          | type of drug D-penicillamine or placebo                                                              | Feature|
| Age           | age in days                                                                                          | Feature|
| Sex           | M (male) or F (female)                                                                               | Feature|
| Ascites       | presence of ascites N (No) or Y (Yes)                                                                | Feature|
| Hepatomegaly  | presence of hepatomegaly N (No) or Y (Yes)                                                           | Feature|
| Spiders       | presence of spiders N (No) or Y (Yes)                                                                | Feature|
| Edema         | presence of edema N (no edema and no diuretic therapy for edema), S (edema present without diuretics, or edema resolved by diuretics), or Y (edema despite diuretic therapy) | Feature|
| Bilirubin     | serum bilirubin (mg/dl)                                                                              | Feature|
| Cholesterol   | serum cholesterol (mg/dl)                                                                            | Feature|
| Albumin       | albumin (gm/dl)                                                                                      | Feature|
| Copper        | urine copper (ug/day)                                                                                | Feature|
| Alk_Phos      | alkaline phosphatase (U/liter)                                                                       | Feature|
| SGOT          | SGOT (U/ml)                                                                                          | Feature|
| Tryglicerides | tryglicerides                                                                                        | Feature|
| Platelets     | platelets per cubic (ml/1000)                                                                        | Feature|
| Prothrombin   | prothrombin time (s)                                                                                 | Feature|
| Stage         | histologic stage of disease (1, 2, 3, or 4)                                                          | Feature|

# Analysis
## Preprocessing
### Load the data and first overview
First, it is necessary to load the data set and gain a first overview of the data in it and its structure.

```{r}
# Load the dataset
cirrhosis_data <- read.csv("../data sets/cirrhosis.csv")

# Display the structure and summary of the data
str(cirrhosis_data)
```
The structure of the data set shows that there are 418 entries and 20 variables in total. The 'Status' column describes the patient's status (C for censored, CL for censored due to liver transplant, or D for death) and is the target variable. Age is recorded in days, and sex is denoted by M for male or F for female. The presence of ascites, hepatomegaly, spiders (vascular lesions), and oedema are categorised as ‘Y’ for yes and ‘N’ for no. Biochemical measurements include bilirubin (mg/dl), cholesterol (mg/dl), albumin (gm/dl), copper (ug/day), alk_phos (U/liter), SGOT (U/ml), triglycerides, and platelets (per cubic ml/1000). Furthermore, the dataset includes prothrombin time (s) and the histologic stage of the disease (ranging from 1 to 4).

```{r}
summary(cirrhosis_data)
```
The summary of the data set shows that the 418 contained observations include the number of days from registration to outcome (N_Days), which ranges from 41 to 4795 days, with a median of 1730 days. Patient ages span from 9598 (26 years) to 28650 days (78 years), with a median of 18628 days (51 years). Serum bilirubin levels show significant variation, ranging from 0.3 to 28 mg/dl, with a median of 1.4 mg/dl. Cholesterol levels range from 120 to 1775 mg/dl, with a median of 309.5 mg/dl, but have 134 missing values. Alkaline phosphatase levels also vary widely, from 289 to 13862.4 U/liter, with a median of 1259 U/liter and 106 missing values. This overview highlights the diverse range and variability of critical clinical measurements within the patient population.

### Subtract irrelevant variables
As the ID variable and the N_Days variable are not classified as features, they should be excluded from the data set to prepare it for the further analysis:
```{r}
cirrhosis_data <- subset(cirrhosis_data, select = -ID)
cirrhosis_data <- subset(cirrhosis_data, select = -N_Days)
```

### Convert categorical variables to factors
To ensure an accurate model training in a later step, it is important to convert the categorical variables from the data set to factors. This leads to the fact that the algorithm treat them as categories.
```{r}
# Convert categorical variables to factors
cirrhosis_data$Status <- factor(cirrhosis_data$Status)
cirrhosis_data$Drug <- factor(cirrhosis_data$Drug)
cirrhosis_data$Sex <- factor(cirrhosis_data$Sex)
cirrhosis_data$Ascites <- factor(cirrhosis_data$Ascites)
cirrhosis_data$Hepatomegaly <- factor(cirrhosis_data$Hepatomegaly)
cirrhosis_data$Spiders <- factor(cirrhosis_data$Spiders)
cirrhosis_data$Edema <- factor(cirrhosis_data$Edema)
```

### Eliminate missing values
Next, it is important to eliminate the rows with missing values to maintain the integrity of the data set. The following summary shows, that there are no more missing values (NA) anymore.
```{r}
cirrhosis_data <- na.omit(cirrhosis_data)
summary(cirrhosis_data)
```

### Normalizing of numerical features
As a next step the numerical features have to be normalized to contribute equally to the training process of the model later. This prevents that some features might be dominating due to higher values.
```{r}
# Normalize numerical features
preProcValues <- preProcess(cirrhosis_data[, c('Age', 'Bilirubin', 'Cholesterol', 'Albumin', 'Copper', 'Alk_Phos', 'SGOT', 'Tryglicerides', 'Platelets', 'Prothrombin')], method = c("center", "scale"))
cirrhosis_data_normalized <- predict(preProcValues, cirrhosis_data[, c('Age', 'Bilirubin', 'Cholesterol', 'Albumin', 'Copper', 'Alk_Phos', 'SGOT', 'Tryglicerides', 'Platelets', 'Prothrombin')])
cirrhosis_data <- cbind(cirrhosis_data[, -c(which(names(cirrhosis_data) %in% c('Age', 'Bilirubin', 'Cholesterol', 'Albumin', 'Copper', 'Alk_Phos', 'SGOT', 'Tryglicerides', 'Platelets', 'Prothrombin')))], cirrhosis_data_normalized)
```

## Random Forest Model
### Split data in training and test set
The data set have to be split in training and test set in order to evaluate the models performance on unseen data. Setting a seed is an effective method to ensure the reproducibility of the results. The training set is used to train the model, while the test set is used to evaluate its performance.
```{r}
set.seed(123)
trainIndex <- createDataPartition(cirrhosis_data$Status, p = 0.8, 
                                  list = FALSE)
dataTrain <- cirrhosis_data[ trainIndex,]
dataTest  <- cirrhosis_data[-trainIndex,]
```
